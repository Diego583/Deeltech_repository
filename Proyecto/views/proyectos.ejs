<%- include('partials/head.ejs') %>

<%- include('partials/navbarProyectos.ejs') %>

<main class="container-fluid row align-items-center">
<h1 class="col-md-12 text-center text-white"> Proyectos </h1>
<input class="form-control" type="text" placeholder="Search" name="buscar" id="buscar" onkeyup="buscar()">

<div class = "row" id="resultados">

    <% for (let proyecto of proyectos) { %>
        <div class="col-sm-12 col-md-6 col-lg-4">
            <div><br></div>
            <div class="card bg-dark" style="height: 27rem; width: 27rem;">
                <img src="<%= proyecto.imagen %>" class="card-img-top" alt="<%= proyecto.imagen %>" height="200 px">
                <div class="card-body">
                  <h5 class="card-title text-success"><%= proyecto.nombre_proyecto %></h5>
                  <p class="card-text "><%= proyecto.descripcion %>"</p>
                  <a href="/proyectos/reportes" class="btn btn-secondary">Ir a proyecto</a>
                </div>
            </div>
            <div><br></div>
        </div>
        <% } %>

</div>



<% if (userRol == 7001) { %>
<div class="col-sm-12 col-md-6 col-lg-4">
    <div class="card bg-success" style="width: 27rem;">
        <a class="btn btn-sucess" href="/proyectos/nuevo_proyecto" role="button">
            <i class="fas fa-plus-circle "></i>
        </a>
    </div>
</div>
<% } %>

</main>

<%- include('partials/footer.ejs') %>

<script>
    function buscar(){

        const valor_busqueda = document.getElementById('buscar').value;
        
        //const csrf = document.getElementById('_csrf').value; //El token de protección CSRF  -- DESCOMENTAR --

        let data = {valor_busqueda: valor_busqueda};
        console.log(valor_busqueda);

        
        //función que manda la petición asíncrona
        fetch('/proyectos/buscar', {
            method: 'POST',

            body: JSON.stringify(data),

            headers: {
                // 'csrf-token': csrf,  -- DESCOMENTAR --
                'Content-Type': 'application/json'
            }

        }).then(result => {
            return result.json(); //Regresa otra promesa
        }).then(data => {
            //Modificamos el DOM de nuestra página de acuerdo a los datos de la segunda promesa
            console.log(valor_busqueda);

            let html = '';
            for (let proyecto of data) {

                html +=    '<div class="col-sm-12 col-md-6 col-lg-4">' +
                        '<div><br></div>' +
                        '<div class="card bg-dark" style="height: 27rem; width: 27rem;">' +
                            '<img src=" ' + proyecto.imagen + ' " class="card-img-top" alt=" ' + proyecto.imagen + ' " height="200 px">' +
                            '<div class="card-body">' +
                            '<h5 class="card-title text-success"> ' + proyecto.nombre_proyecto + ' </h5>' +
                            '<p class="card-text "> ' + proyecto.descripcion + ' "</p>' +
                            '<a href="/proyectos/reportes" class="btn btn-secondary">Ir a proyecto</a>' +
                            '</div>' +
                        '</div>' +
                        '<div><br></div>' +
                    '</div>';
        }
        document.getElementById("resultados").innerHTML = html;

        }).catch(err => {
            console.error(err);
        });

    }
</script>